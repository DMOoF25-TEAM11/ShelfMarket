<UserControl x:Class="ShelfMarket.UI.Views.UserControls.SideMenuView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:ShelfMarket.UI.Views.UserControls"
             xmlns:viewmodels="clr-namespace:ShelfMarket.UI.ViewModels"
             xmlns:conv="clr-namespace:ShelfMarket.UI.Converters"
             d:DataContext="{d:DesignInstance Type=viewmodels:SideMenuViewModel}"
             mc:Ignorable="d">
    <UserControl.Resources>
        <conv:PrivilegeToVisConverter x:Key="PrivilegeToVis"/>
    </UserControl.Resources>
    <UserControl.DataContext>
        <viewmodels:SideMenuViewModel />
    </UserControl.DataContext>
    <Border Background="{StaticResource Brush.SurfaceAlt}"
            BorderBrush="{StaticResource Brush.Border}"
            BorderThickness="0,0,1,0">
        <DockPanel LastChildFill="True">
            <Border DockPanel.Dock="Top" Padding="16"
                    BorderThickness="0,0,0,1" BorderBrush="{StaticResource Brush.Border}">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Image Source="/Views/Graphic/Reolmarkedet-logo.png"
                           Width="228" Height="138"
                           Stretch="UniformToFill"/>
                </StackPanel>
            </Border>

            <ListBox x:Name="LeftMenu"
                     ItemsSource="{Binding SideMenuItems}"
                     DisplayMemberPath="Title"
                     Style="{StaticResource Nav.ListBox}"
                     SelectedItem="{Binding SelectedMenuItem, Mode=TwoWay}">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource Nav.ListBoxItem}">
                        <!-- Re-evaluate on role changes -->
                        <Setter Property="Visibility">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource PrivilegeToVis}">
                                    <Binding Path="Privilege"/>
                                    <Binding RelativeSource="{RelativeSource AncestorType=UserControl}" Path="DataContext.CurrentLevel"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>

                        <!-- Only hide 'Log på' when logged in (User/Admin) -->
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Title}" Value="Log på"/>
                                    <Condition Binding="{Binding DataContext.CurrentLevel, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="User"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Title}" Value="Log på"/>
                                    <Condition Binding="{Binding DataContext.CurrentLevel, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="Admin"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </MultiDataTrigger>

                            <!-- Hide 'Log af' when Guest -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsLogoff}" Value="True"/>
                                    <Condition Binding="{Binding DataContext.CurrentLevel, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="Guest"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </DockPanel>
    </Border>
</UserControl>
